<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title></title>
  <style>
        * {
      box-sizing: border-box;
      padding: 0;
      margin: 0;
    }
    
    body {
      background: radial-gradient(ellipse at center, #0d1117 0%, #000000 100%);
      font-family: 'Segoe UI', sans-serif;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
      background-image: url("../assets/bg2.png");
      background-size: 100% 100%;
      user-select: none;
    }
h1 {
      font-size: 2.5em;
      color: #00f0ff;
      margin-bottom: 20px;
      text-shadow: 0 0 10px #00f0ff;
    }

    .bottle-btn {
      width: 120px;
      height: 120px;
      background-image: url('../assets/bottle.png'); /* Replace with your bottle image */
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      animation: rotate 2.5s linear infinite;
      margin-bottom: 40px;
      filter: drop-shadow(0 0 10px #00f0ff);
    }

    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
#online_1 {
  display: flex;
flex-direction: column;
gap: 15px;
width: 90%;
max-width: 300px;
box-shadow: 0.5px 0.5px 1px 0.5px black;
}
    #online {
      display: flex;
      flex-direction: column;
      gap: 15px;
      width: 90%;
      max-width: 300px;
    box-shadow: 0.5px 0.5px 1px 0.5px black;
    display: none;
    }

    #online div,
    #online_1 div{
      padding: 12px 20px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid #00f0ff55;
      color: #fff;
      border-radius: 12px;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      backdrop-filter: blur(4px);
      text-align: center;
    }

    #online div:hover,
    #online_1 div:hover {
      background: #00f0ff;
      color: #000;
      transform: scale(1.05);
      font-weight: bold;
      box-shadow: 0 0 12px #00f0ff;
    }
   #gameScreen {
      position: absolute;
width: 100%;
height: 100vh;
top: 0px;
left: 0px;
overflow: hidden;
display: none;
/*display: flex;*/
    }
    #gameArea {
      position: relative;
      width: 100%;
      height: 100vh;
    /*  overflow: auto;*/
   
    }

    #bottle {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%) rotate(0deg);
      width: 60px;
      height: 120px;
      background: url('../assets/bottle.png') no-repeat center;
      background-size: contain;
      z-index: 10000;
    
    }

    #floor {
      position: absolute;
      bottom: 220px;
      left: 0;
      width: 100%;
      height: 300px;
      background: transparent;
      z-index: 100;
    }

    #chargeBar {
      width: 300px;
      height: 20px;
      background: #ccc;
      margin: 20px auto;
      border-radius: 10px;
      overflow: hidden;
  
    }

    #chargeFill {
      width: 0%;
      height: 100%;
      /*background: #4caf50;*/
      background: linear-gradient(to right, greenyellow, green, yellow, red );
    }

    #btn {
      padding: 15px 30px;
      font-size: 18px;
      margin-top: 10px;
      cursor: pointer;
      font-size: 16px;
border: none;
border-radius: 10px;
background: #00ffd5;
color: #000;
font-weight: bold;
cursor: pointer;
transition: background 0.3s;
margin-left: 50%;
margin-top: 30px;
transform: translate(-50%,  -50%);
    }

    #message {
      font-size: 20px;
      height: 30px;
      margin-top: 10px;
      margin-left: 50%;
transform: translate(-50%, -50%);
    }
    #floor {
      position: absolute;
      width: 350px;
      height: 270px;
      margin-left: -15px;
      margin-top: -3px;
    }
      #popupOverlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 99999;
    animation: fadeIn 0.4s ease-out forwards;
  }

  #popupBox {
    background: #fff;
    padding: 30px 20px;
    border-radius: 16px;
    text-align: center;
    width: 90%;
    max-width: 300px;
    transform: scale(0.6);
    opacity: 0;
    animation: zoomIn 0.4s ease-out forwards;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
  }

  #popupBox h2 {
    margin-top: 0;
    color: #333;
  }

  #popupBox p {
    font-size: 16px;
    color: #555;
  }

  #popupBox button, .button {
    margin-top: 15px;
    padding: 10px 25px;
    background: #00ffd5;
    color: #000;
    border: none;
    border-radius: 10px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s;
  }

  #popupBox button:hover {
    background: #00c8aa;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes zoomIn {
    from {
      transform: scale(0.6);
      opacity: 0;
    }
    to {
      transform: scale(1);
      opacity: 1;
    }
  }
      .player-bar,
      .player-barr {
      display: flex;
      justify-content: center;
      gap: 1rem;
      padding: 1rem;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      backdrop-filter: blur(5px);
      max-width: 90%;
      flex-wrap: wrap;
     
    }

    .player,
    .playerr{
      padding: 0.75rem 1rem;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.2);
      transition: all 0.3s ease;
      min-width: 90px;
      text-align: center;
    }
.playerr {
  color: white;
  min-width: 20px;
}
    .current {
      border: 2px solid #1de9b6;
      box-shadow: 0 0 12px #1de9b6;
      background-color: rgba(29, 233, 182, 0.1);
      color: #1de9b6;
    }

    .turn-button {
      margin-top: 2rem;
      padding: 0.75rem 1.5rem;
      background-color: #1de9b6;
      color: #0f172a;
      border: none;
      border-radius: 999px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .turn-button:hover {
      background-color: #16c9a1;
    }

    .turn-message {
      margin-top: 2rem;
      font-size: 1.5rem;
      font-weight: bold;
      background: linear-gradient(90deg, #1de9b6, #ffffff, #1de9b6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shine 3s linear infinite;
    }

    @keyframes shine {
      0% {
        background-position: -200% center;
      }
      100% {
        background-position: 200% center;
      }
    }

    @media (max-width: 500px) {
      .player {
        font-size: 0.9rem;
        padding: 0.5rem 0.75rem;
      }
    }
  </style>
</head>

<body>
    <h1 style="margin-top: -40px;" id="1h1">FlipRoyale</h1>
  
  <div class="bottle-btn" onclick="spinBottle()" id="bot1s"></div>
  
  <!--<h3>👥 Players Online – Click a name to join, or tap "Host" to create your own match.</h3>-->
    <div id="online_1">
    <div onclick="TwoP()">Two Players Online</div>
    <div onclick="mainMenu()">MainMenu</div>
  </div>
  
  <div id="online">
    
    <div>Connecting...</div>
  </div>
  
 <div id="gameScreen">
         <div class="player-barr">
      <div class="playerr" id="playersc">0</div>
      <div class="playerr" id="cpusc">0</div>
    </div>
    
    <div class="player-bar" id="playerBar">
    <div class="player current" id="plyname">Samuel</div>
    <div class="player" id="oppname">...</div>
  </div>
  
  <div id="chargeBar"><div id="chargeFill"></div></div>
  <button id="btn">Hold to Charge</button>
  <div id="message"></div>
  <div id="gameArea">
    <div id="bottle"></div>
    
    <div id="floor"><img src="../assets/table.png" alt="" height="100%" width="100%"></div>
    
  </div>
 <button onclick="Quit()" style="position: absolute; top: 0px; left: 70%;" class="button">Quit Game</button> 
 </div>
  <div id="popupOverlay">
<div id="popupBox">
  <h2 id="pophead">👋 Welcome</h2>
  <p id="popcobt">🌟 Welcome to Flip Royale! 🌟
Join the multiplayer arena, test your luck, and flip your way to victory! 🪙🔥</p>
  <button onclick="closePopup()" id="popcobtn">Continue</button>
</div>
</div>
<script>
let popupBox = document.getElementById("popupOverlay");
  function closePopup() {
    setTimeout(() => {
popupBox.style.display = "none";
 // parent.postMessage("gameover", "*");
}, 20);
  }
var username = JSON.parse(localStorage.getItem("fancystar_fliproyale")).gamingName;
 var alphabets = ["a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k"];
    var numbers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
function generateId(length) {
  let id = "";
  for (i=0; i<=length; i++) {
    id+=alphabets[Math.floor(Math.random() * alphabets.length)];
    id+=numbers[Math.floor(Math.random() * numbers.length)];
  }
  
  return id;
  //return "i8e2j7i0f3h6k9j3h2";
}
var added = false;
var plyid;
  function addNew() {
    var req = new XMLHttpRequest();
    req.onload = function() {
    //  console.log(this.responseText);
    if (this.responseText == "success") {
      added = true;
      checkbg = true;
      runBg();
    }
    }
    plyid = generateId(8);
    runid = plyid;
    req.open("GET", "https://fancystars.com.ng/Games/multi_v1.0/multi.php?id="+plyid+"&name="+username, true);
  //  req.open("GET", "https://fancystars.com.ng/Games/multi_v1.0/list.txt?id=ghy&name=sam", true);
    req.send();
  }
 // fetchList();
  function fetchList() {
    var req = new XMLHttpRequest();
req.onload = function() {
  if (!this.responseText.includes("File not found or not allowed.")) {
    document.getElementById("online").innerHTML = "Players Online: Click on a player to connect"+ this.responseText + `<hr><div onclick="mainMenu()">MainMenu</div>`;
    if (this.responseText.includes(localStorage.getItem("lastiid"))) {
      Off(localStorage.getItem("lastiid"));
      terminate(localStorage.getItem("lastiid") + ".txt");
    }
   if (!added) {
    addNew();
    setTimeout(() => {
      localStorage.setItem("lastiid", plyid);
    }, 2000);
   }
   else {
     if (this.responseText.includes(plyid)) {
       document.getElementById(plyid).remove();
       //alert("")
     }
   }
    var buttons = document.querySelectorAll(".list");
// Loop through and attach click event
buttons.forEach(btn => {
  btn.addEventListener("click", function() {
   // console.log("Clicked ID:", this.id);
   connect(this.id);
  // runid = this.id;
    // or: console.log("Clicked ID:", btn.id);
  });
});
  }
  else {
    document.getElementById("online").innerHTML = "<span style='color: red'>Error...., Reconnecting...</span>"+`<hr><div onclick="mainMenu()">MainMenu</div>`;
    setTimeout(() => {
      fetchList();
      //console.log(this.responseText)
    }, 500);
  }

}
req.onerror = function() {
 document.getElementById("online").innerHTML = "<span style='color: red'>Error...., Reconnecting...</span>"+ `<hr><div onclick="mainMenu()">MainMenu</div>`;
setTimeout(() => {
  fetchList();
  //console.log(this.responseText)
}, 1000);
}
req.open("GET", "https://fancystars.com.ng/Games/multi_v1.0/list.php?q=list.txt&t="+new Date().getMilliseconds(), true);
//  req.open("GET", "https://fancystars.com.ng/Games/multi_v1.0/list.txt?id=ghy&name=sam", true);
req.send();
  }
  
  // Get all elements with the class

//  fetchList();
//  addNew();
var checkbg = false;
var runid = "intro";
var errorcon = 0;
var errorcon2 = 0;
var opponentName = "...";
function runBg() {
  if (added) {
  var req = new XMLHttpRequest();
req.onload = function() {
    if (this.responseText.includes("File not found or not allowed.")) {
      if (runid == opponentid) {
        if (errorcon >= 6) {
          errorcon = 0;
          runid = plyid;
          document.getElementById("online").innerHTML = "<span style='color: red'>Error...., ...</span>";
setTimeout(() => {
  fetchList();
}, 1000);
        }
        else {
       errorcon++;
       runBg();
        }
      }
    //  document.getElementById("online").innerHTML = "Players Online: Click on a player to connect" + this.responseText;
    }
    else {
      analyze(this.responseText);
    //  alert("hi")
    }
   if (checkbg) {
     runBg();
   }
}
req.open("GET", "https://fancystars.com.ng/Games/multi_v1.0/list.php?q="+runid+".txt&t=" + new Date().getMilliseconds(), true);
//  req.open("GET", "https://fancystars.com.ng/Games/multi_v1.0/list.txt?id=ghy&name=sam", true);
req.send();
}
}
var opponentid;
function connect(id) {
  opponentid = id;
 var req = new XMLHttpRequest();
req.onload = function() {
  if (this.responseText.includes("success")) {
    runid = opponentid;
    //  document.getElementById("online").innerHTML = "Players Online: Click on a player to connect" + this.responseText;
  }
  else {
    //analyze(this.responseText);
    document.getElementById("online").innerHTML = "<span style='color: red'>Error...., ...</span>";
    setTimeout(() => {
  fetchList();
}, 1000);
  }
 /* if (checkbg) {
    runBg();
  }*/
}
req.onerror = function() {
  document.getElementById("online").innerHTML = "<span style='color: red'>Error...., ...</span>";
setTimeout(() => {
  runid = plyid;
  fetchList();
}, 1000);
}
var msg = {
  name: username,
  name2: null,
  cont: "connect"
}
var msg2 = JSON.stringify(msg);
console.log(msg2);
req.open("GET", "https://fancystars.com.ng/Games/multi_v1.0/create.php?q="+id+".txt&cont="+encodeURIComponent(msg2)+"&t=" + new Date().getMilliseconds(), true);
//  req.open("GET", "https://fancystars.com.ng/Games/multi_v1.0/list.txt?id=ghy&name=sam", true);
req.send();

  document.getElementById("online").innerHTML = "<span style='color: green'>Connecting...</span>";
}
let cace = false;
function analyze(response) {
  checkbg = false;
  var responsec = JSON.parse(decodeURIComponent(response));
  if (connected) {
  //  console.log(responsec);
 if (client&& hostturn&& response.includes(`"cont":[`)) {
   chargeFill.style.width = '0%';
      charge = responsec.cont[0];
      chargeFill.style.width = `${(charge / 20) * 100}%`;
      if (responsec.cont[1]) {
        stopCharging(true);
      }
 }
    runBg();
  }
  else if (responsec.cont == "connect"&& runid != opponentid&& !connected) {
   // alert("Someone wants to connect");
   popMsg("Connection Request", `${responsec.name} wants to connect`);
   opponentName = responsec.name;
  }
  else if (responsec.name2 != null&& runid == opponentid&& !cace) {
    accept2();
    opponentName = responsec.name2;
    document.getElementById("online").innerHTML = "<span style='color: green'>Connection Successful...., Loading...</span>";
      cace = true;
    checkbg = true;
    setTimeout(() => {
      runBg();
      StartG(true);
    }, 2000);
    }
  else if (responsec.cont == "connect"&& !cace) {
    runBg();
    if (runid == opponentid) {
      if (errorcon2 >= 100) {
  terminate(opponentid + ".txt");
  errorcon2 = 0;
  document.getElementById("online").innerHTML = "<span style='color: red'>Error...., ...</span>";
  setTimeout(() => {
    runid = plyid;
    fetchList();
  }, 1000);
}

else {
  errorcon2++;
  console.log(errorcon2);
}
    }
  }
}

function popMsg(head, body) {
  document.getElementById("popupBox").innerHTML = `<h2 id="pophead">${head}</h2>
  <p id="popcobt">${body}</p>
  <button onclick="accept()" id="popcobtn">Accept</button>
  <button onclick="decline()" id="popcobtn2">Decline</button>`;
  document.getElementById("popupOverlay").style.display = "flex";
}
var connected = false;
function accept() {
  accept2();
  accept3();
  var file = plyid+".txt";
  var ocont = `"name2":null`;
  var ncont = `"name2":"${username}"`;
  var req = new XMLHttpRequest();
req.onload = function() {
   if (this.responseText.includes("created")) {
   closePopup();
   setTimeout(() => {
     connected = true;
   checkbg = true;
   runBg();
   StartG(false);
   }, 2000);
 }
 else {
   closePopup();
   alert("An Error Occured");
 }
}
req.open("GET", "https://fancystars.com.ng/Games/multi_v1.0/update.php?q="+plyid+".txt&search=" + ocont + "&replace=" + ncont + "&t=" + new Date().getMilliseconds(), true);
req.send();
}
function accept2() {
  var search = `<div class='list' id='${plyid}'>${username}</div>`;
  var replace = "";
  var req = new XMLHttpRequest();
req.onload = function() {
 if (this.responseText.includes("created")) {
  
 }
 else {
   
 }
}
req.open("GET", "https://fancystars.com.ng/Games/multi_v1.0/update.php?q=list.txt&search="+search+"&replace="+replace+"&t=" + new Date().getMilliseconds(), true);
req.send();
}

function accept3() {
  var ocont = `"cont":"connect"`;
var ncont = `"cont":"game"`;
var req = new XMLHttpRequest();
req.onload = function() {
  if (this.responseText.includes("created")) {
   /* closePopup();
    checkbg = true;
    runBg();*/
  }
  else {
   /* closePopup();
    alert("An Error Occured");*/
  }
}
req.open("GET", "https://fancystars.com.ng/Games/multi_v1.0/update.php?q=" + plyid + ".txt&search=" + ocont + "&replace=" + ncont + "&t=" + new Date().getMilliseconds(), true);
req.send();
}

function decline() {
  terminate(plyid+".txt");
  closePopup();
}
function terminate(file) {
/*  var search = `<div class='list' id='${plyid}'>${username}</div>`;
var replace = "";*/
var req = new XMLHttpRequest();
req.onload = function() {
  if (this.responseText.includes("created")) {
    
  }
  else {
    
  }
}
req.open("GET", "https://fancystars.com.ng/Games/multi_v1.0/delete.php?q="+file+"&t=" + new Date().getMilliseconds(), true);
req.send();
}

function Off(id) {
  var search = `<div class='list' id='${id}'>${username}</div>`;
  var replace = "";
  var req = new XMLHttpRequest();
  req.onload = function() {
    if (this.responseText.includes("created")) {
      localStorage.setItem("lastiid", plyid);
    }
    else {
      
    }
  }
  req.open("GET", "https://fancystars.com.ng/Games/multi_v1.0/update.php?q=list.txt&search=" + search + "&replace=" + replace + "&t=" + new Date().getMilliseconds(), true);
  req.send();
}
function TwoP() {
  setTimeout(() => {
    document.getElementById("online_1").style.display = "none";
   document.getElementById("online").style.display = "block";
   fetchList();
  }, 200)
}
function mainMenu() {
  if (plyid) {
    Off(plyid);
    terminate(plyid+".txt");
    setTimeout(() => {
      parent.postMessage("gameover", "*");
    }, 500);
  }
  else {
    setTimeout(() => {
  parent.postMessage("gameover", "*");
}, 200);
  }
}
 // checkStart();
  var loaded = false;
 function checkStart() {
   if (client) {
    document.getElementById("btn").style.display = "none"; 
    message.innerText = "Waiting for "+opponentName;
   }
    showPopup("•Don't flip too high<br> •The First player to have 15 points wins the game", "👌 Tip");
  }
    const bottle = document.getElementById('bottle');
    const chargeFill = document.getElementById('chargeFill');
    const btn = document.getElementById('btn');
    const message = document.getElementById('message');
var playerScore = document.getElementById("playersc");
var botScore = document.getElementById("cpusc");
var nxtturn = false;
let score = 0;
let cpuscore = 0;
    const bottleHeight = 120;
    const floorHeight = 40;

    let floorY = window.innerHeight/2 - bottleHeight - floorHeight;
    let positionY = floorY;
    let velocityY = 0;
    let gravity = 0.6;
    let rotation = 0;
    let rotationVelocity = 0;
    let bounceCount = 0;
    let charging = false;
    let charge = 0;
    let chargeInterval;
    let isAnimating = false;
/*let hhhy =  { h: [[1, false], [1, false]]};
console.log(JSON.stringify(hhhy))*/
    bottle.style.top = `${floorY}px`;
    var oldrepl = `"cont":"game"`;
    var hostturn = true;
    var clientturn = false;
    function startCharging() {
      if (isAnimating) return;
      charging = true;
      charge = 0;
      chargeFill.style.width = '0%';
      chargeInterval = setInterval(() => {
        charge = Math.min(charge + 0.2, 20);
        chargeFill.style.width = `${(charge / 20) * 100}%`;
        var oldg;
        var newgg;
     //   var ply;
        /*if (!client&& hostturn) {
          oldgg = oldrepl;
          newgg = `"cont":[${charge}, false]`;
          gameUpdate(oldgg, newgg);
          oldrepl = newgg;
        }
        else if (clientturn&& client) {
          oldgg = oldrepl;
newgg = `"cont":[${charge}, false]`;
gameUpdate(oldgg, newgg);
oldrepl = newgg;
        }*/
      }, 30);
    }
let wintime = true;
    function stopCharging(tp) {
      if (tp == true) {
        charging = true;
      }
      if (!charging || isAnimating) return;
      charging = false;
     if (tp != true) {
      if (!client && hostturn) {
  oldgg = oldrepl;
  newgg = `"cont":[${charge}, true]`;
 // gupdate = true;
  gameUpdate(oldgg, newgg);
  oldrepl = newgg;
}
else if (clientturn && client) {
  oldgg = oldrepl;
  newgg = `"cont":[[${0}, ${0}], [${charge}, ${true}]]`;
 // gupdate = true;
  gameUpdate(oldgg, newgg);
  oldrepl = newgg;
}
}
      clearInterval(chargeInterval);
      chargeFill.style.width = '0%';
      if (allowplay&&charge > 2.0&&  charge < 3.0&& wintime) {
        charge = 2.6;
        wintime = false;
      }
      if (allowplay && charge > 5.0 && charge < 6.0 && wintime) {
  charge = 5.6;
  wintime = false;
}
      launchBottle();
    }

    function launchBottle() {
      isAnimating = true;
      velocityY = -charge * 2.5;
      rotationVelocity = charge * 3;
      bounceCount = 0;
      message.textContent = '';
      requestAnimationFrame(update);
    }

    function update() {
      velocityY += gravity;
      positionY += velocityY;
      rotation += rotationVelocity;

      if (positionY >= floorY) {
        positionY = floorY;

        if (Math.abs(velocityY) > 1) {
          velocityY = -velocityY * 0.45;
          rotationVelocity *= 0.9;
          bounceCount++;
        } else {
          velocityY = 0;
          rotationVelocity *= 0.95;
          bounceCount++;
        }

        if (Math.abs(velocityY) < 0.3 && Math.abs(rotationVelocity) < 0.1 && bounceCount > 1) {
          rotation = rotation % 360;
          settleBottle(rotation);
          return;
        }
      }

      updateVisuals();
      requestAnimationFrame(update);
    }

    function updateVisuals() {
      bottle.style.top = `${positionY}px`;
      bottle.style.transform = `translateX(-50%) rotate(${rotation}deg)`;
    }

    function settleBottle(angle) {
      isAnimating = false;

      if (angle >= 330 || angle <= 30) {
        // Upright
        smoothRotateTo(0);
 if (allowplay) {
   score += 1;
 }
 if (!allowplay) {
   cpuscore += 1;
 }

 nxtturn = false;
        message.textContent = "🎯 Perfect Landing!";
   if (allowplay) {
    /*allowplay = false;
     nextTurn();
     allowplay = true;*/
   }
   //nextTurn();
        showPopup((perfectMessages[Math.floor(Math.random() * perfectMessages.length)]),"🎯 Perfect!");
        
         if (score >= 15|| cpuscore >= 15) {
   winGame();
 }
      } else if (angle > 30 && angle < 150) {
        
        // Fall right
        nxtturn = true;
        bottle.style.marginTop = "15px";
        smoothRotateTo(90);
        message.textContent = "💥 It Fell!";
        if (allowplay) {
          wintime = true;
        }
        showPopup((failMessages[Math.floor(Math.random() * failMessages.length)]),"💥 Oops!")
      } else if (angle > 210 && angle < 330) {
        // Fall left
        nxtturn = true;
        smoothRotateTo(270);
        bottle.style.marginTop = "15px";
        message.textContent = "💥 It Fell!";
        if (allowplay) {
  wintime = true;
}
        showPopup((failMessages[Math.floor(Math.random() * failMessages.length)]),"💥 Oops!")
      } else {
        // Backward
        nxtturn = true;
        smoothRotateTo(180);
        message.textContent = "💥 It Fell!";
        showPopup((failMessages[Math.floor(Math.random() * failMessages.length)]),"💥 Oops!")
      }
      
    }

    function smoothRotateTo(targetAngle) {
      const step = () => {
        const diff = targetAngle - rotation;
        if (Math.abs(diff) < 1) {
          rotation = targetAngle;
          updateVisuals();
          return;
        }
        rotation += diff * 0.2;
        updateVisuals();
        requestAnimationFrame(step);
      };
      step();
    }
var allowplay = true;
    // Event listeners
    btn.addEventListener('mousedown',()=> {if (allowplay) {
      startCharging();
    }});
    btn.addEventListener('mouseup', stopCharging);
    btn.addEventListener('mouseleave', () => charging && stopCharging());

    btn.addEventListener('touchstart', (e) => {
     setTimeout(() => {
       btn.innerText = "Release to Flip";
     }, 50);
      e.preventDefault();
      if (allowplay) {
      startCharging();
      }
    });

    btn.addEventListener('touchend', (e) => {
      setTimeout(() => {
  btn.innerText = "Hold to Charge";
}, 50);
      e.preventDefault();
      if (allowplay) {
      stopCharging();
      }
    });

    // Resize handling
    document.getElementById("floor").style.top = (floorY - 15) + "px";
    document.getElementById("floor").style.left = ((innerWidth/2)-160)+"px";
    window.addEventListener('resize', () => {
      floorY = window.innerHeight/2 - bottleHeight - floorHeight;
      
      if (!isAnimating) {
        positionY = floorY;
        bottle.style.top = `${positionY}px`;
      }
    });
    
    /*setTimeout(() => {
      //startCharging();
      charge = 2.6;
      charging = true
    }, 1000);
    setTimeout(() => {
    
  stopCharging();
}, 2400);*/

//1400 2.6 2.7 2.8 3.85 6.9
const failMessages = [
  "💥 Oops... Try again!",
  "😅 Not quite!",
  "👎 It flopped!",
  "😬 So close!",
  "🙈 Whoopsie!",
  "🫠 Gravity wins!",
  "🤦‍♂️ That didn’t work!",
  "🫢 Bottle down!",
];

const perfectMessages = [
  "🎯 Perfect Landing!",
  "🔥 Bottle Boss!",
  "✅ Clean Landing!",
  "🏆 You’re a flippin’ legend!",
  "🙌 Smooth move!",
  "🎉 That was awesome!",
  "💫 Gravity? Never heard of it!",
  "✨ That's precision!",
];


  function showPopup(message, title = "message") {
    const overlay = document.getElementById("popupOverlay");
    const box = document.getElementById("popupBox");
    box.innerHTML = `<h2 id="pophead">${title}</h2>
  <p id="popcobt">${message}</p>
  <button onclick="closePopup2()" id="popcobtn">Continue</button>`;
    /*document.querySelector("#pophead").innerText = title;
    document.querySelector("#popcobt").innerHTML = message;*/

    overlay.style.display = "flex";

    // Reset animation
    box.style.animation = "none";
    void box.offsetWidth; // Force reflow
    box.style.animation = "zoomIn 0.4s ease-out forwards";
    if (loaded) {
    playerScore.innerText = score;
    botScore.innerText = cpuscore;
    }
  }

  function closePopup2() {
    const overlay = document.getElementById("popupOverlay");
    if (gameover) {
      parent.postMessage("gameover", "*");
    }
    if (!userwin) {
    overlay.style.display = "none";
  }
    if (loaded&& nxtturn&& !userwin) {
      
    bottle.style.transform = `translateX(-50%) rotate(${0}deg)`;
    bottle.style.marginTop = "0px";
    message.innerText = "";
    charge = 0;
    rotation = 0;
    velocityY = 0;
    nextTurn();
    if (current) {
      btn.style.opacity = "0";
      allowplay = false;
    }
    else {
      btn.style.opacity = "1";
      allowplay = true;
    }
    }
    else if (!userwin) {
      loaded = true;
      if (!nxtturn&& !allowplay) {
      //  alert("un")
      message.innerText = "";
        cpuPlay();
      }
    }
  }
  
const players = document.querySelectorAll('.player');
var name;
const userIndex = 0; // Samuel (Player 1) is the user
let current = 0;

function updateTurn() {
  players.forEach((p, i) => {
    p.classList.toggle('current', i === current);
  });
  
   name = players[current].textContent;
  const message2 = current === userIndex ? "Your Turn" :` ${name}'s Turn`;
  message.innerText = message2;
  message.style.color = "greenyellow";
  if (current == 1) {
    cpuPlay();
  }
  setTimeout(() => {
    message.innerText = "";
    message.style.color = "black";
  }, 1000);
  
}

function nextTurn() {
  current = (current + 1) % players.length;
  updateTurn();
}

updateTurn();
  // 🚀 Example usage
  // showPopup("🎯 You nailed it!", "Perfect!");
  //var cpuMoves = [2.6, 4.0, 5.6, 6.9];
  var cpuMoves = [2.6, 5.6, 6.8, 4.0, 6.9, 9.0, 3.0];
  let rt = 0;
function cpuPlay() {
  let randomMove = Math.floor(Math.random() * cpuMoves.length);
  setTimeout(() => {
    let currentMove = cpuMoves[randomMove];
   let tt = setInterval(() => {
      rt++
      if (charge >= currentMove) {
        clearInterval(tt)
        stopCharging();
      }
      
    }, 1);
    startCharging();
  }, 400);
}
var username = JSON.parse(localStorage.getItem("fancystar_fliproyale")).gamingName;
document.getElementById("plyname").innerText = username;
var currentHighscores = JSON.parse(localStorage.getItem("fancystar_fliproyale")).highScores;
var newHighscore = [username, "Cpu-Bot"];
var soundOption = JSON.parse(localStorage.getItem("fancystar_fliproyale")).music;
let userwin = false;
let gameover = false;
function winGame() {
  userwin = true;
  btn.style.opacity = "0";
allowplay = false;
if (score >= 15 ) {
  document.getElementById("popcobtn").style.opacity = 0;
  showPopup(`${username} VS Cpu-Bot <br> ${score} : ${cpuscore}<br> 🎉 ${username} wins the game`, "🏆 Winner");
  setTimeout(() => {
    document.getElementById("popcobtn").style.opacity = 1;
    document.getElementById("popcobtn").innerText = "Continue (Game Over)";
    gameover = true;
  }, 2000);
}
else if (cpuscore >= 15) {
  document.getElementById("popcobtn").style.opacity = 0;
  showPopup(`${username} VS Cpu-Bot <br> ${score} : ${cpuscore}<br> Cpu-Bot wins the game`, "😔 You Lose");
  setTimeout(() => {
    document.getElementById("popcobtn").style.opacity = 1;
    document.getElementById("popcobtn").innerText = "Continue (Game Over)";
    gameover = true;
  }, 2000);
}
newHighscore[2] = score;
newHighscore[3] = cpuscore;
currentHighscores.push(newHighscore);
//console.log(currentHighscores);
var newStorage = {
  gamingName: username,
  highScores: currentHighscores,
  music: soundOption
}
localStorage.setItem("fancystar_fliproyale", JSON.stringify(newStorage));
}

function Quit() {
  /*setTimeout(() => {
    parent.postMessage("gameover", "*");
  }, 200);*/
  mainMenu();
}
var client = false;
function StartG(bool) {
  if (bool) {
  document.getElementById("oppname").innerText = opponentName;
  }
  else {
    document.getElementById("plyname").innerText = opponentName;
    document.getElementById("oppname").innerText = username;
    client = true;
  }
  document.getElementById("online").style.display = "none";
  document.getElementById("1h1").style.display = "none";
  document.getElementById("bot1s").style.display = "none";
  document.getElementById("gameScreen").style.display = "block";
  checkStart();
  runBg();
/*  document.getElementById("popupBox").innerHTML = `<h2 id="pophead">👋 Welcome</h2>
  <p id="popcobt">🌟 Welcome to Flip Royale! 🌟
    Join the multiplayer arena, test your luck, and flip your way to victory! 🪙🔥</p>
  <button onclick="closePopup2()" id="popcobtn">Continue</button>`;*/
}
var gupdate = true;
function gameUpdate(old, newg) {
  if (gupdate) {
    gupdate = false;
  var file = runid + ".txt";
var ocont = old;
var ncont = newg;
var req = new XMLHttpRequest();
req.onload = function() {
  if (this.responseText.includes("created")) {
    gupdate = true;
  //  closePopup();
  /*  setTimeout(() => {
      checkbg = true;
      runBg();
   //   StartG(false);
    }, 2000);*/
   /* if (gupdate) {
      gameUpdate(old)
    }*/
  }
  else {
    gupdate = true;
    gameUpdate(old, newg);
    /*closePopup();
    alert("An Error Occured");*/
  }
}
req.open("GET", "https://fancystars.com.ng/Games/multi_v1.0/update.php?q=" + runid + ".txt&search=" + ocont + "&replace=" + ncont + "&t=" + new Date().getMilliseconds(), true);
req.send();
}
}

function gameUpdate2(old, newg) {
   // gupdate = false;
    var file = runid + ".txt";
    var ocont = old;
    var ncont = newg;
    var req = new XMLHttpRequest();
    req.onload = function() {
      if (this.responseText.includes("created")) {
       // gupdate = true;
        //  closePopup();
        /*  setTimeout(() => {
            checkbg = true;
            runBg();
         //   StartG(false);
          }, 2000);*/
        /* if (gupdate) {
           gameUpdate(old)
         }*/
      }
      else {
     //   gupdate = true;
        gameUpdate2(old, newg);
        /*closePopup();
        alert("An Error Occured");*/
      }
    }
    req.open("GET", "https://fancystars.com.ng/Games/multi_v1.0/update.php?q=" + runid + ".txt&search=" + ocont + "&replace=" + ncont + "&t=" + new Date().getMilliseconds(), true);
    req.send();
  
}
</script>
</body>

  </html>
