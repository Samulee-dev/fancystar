<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flip Royale</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #eef;
      text-align: center;
      overflow: hidden;
      user-select: none;
      background-image: url("../assets/bg2.png");
      background-size: 100% 100%;
    }

    #gameArea {
      position: relative;
      width: 100%;
      height: 100vh;
    /*  overflow: auto;*/
   
    }

    #bottle {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%) rotate(0deg);
      width: 60px;
      height: 120px;
      background: url('../assets/bottle.png') no-repeat center;
      background-size: contain;
      z-index: 10000;
    
    }

    #floor {
      position: absolute;
      bottom: 220px;
      left: 0;
      width: 100%;
      height: 300px;
      background: transparent;
      z-index: 100;
    }

    #chargeBar {
      width: 300px;
      height: 20px;
      background: #ccc;
      margin: 20px auto;
      border-radius: 10px;
      overflow: hidden;
   
    }

    #chargeFill {
      width: 0%;
      height: 100%;
      /*background: #4caf50;*/
      background: linear-gradient(to right, greenyellow, green, yellow, red );
    }

    #btn {
      padding: 15px 30px;
      font-size: 18px;
      margin-top: 10px;
      cursor: pointer;
      font-size: 16px;
border: none;
border-radius: 10px;
background: #00ffd5;
color: #000;
font-weight: bold;
cursor: pointer;
transition: background 0.3s;
    }

    #message {
      font-size: 20px;
      height: 30px;
      margin-top: 10px;
    }
    #floor {
      position: absolute;
      width: 350px;
      height: 270px;
      margin-left: -15px;
      margin-top: -3px;
    }
      #popupOverlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 99999;
    animation: fadeIn 0.4s ease-out forwards;
  }

  #popupBox {
    background: #fff;
    padding: 30px 20px;
    border-radius: 16px;
    text-align: center;
    width: 90%;
    max-width: 300px;
    transform: scale(0.6);
    opacity: 0;
    animation: zoomIn 0.4s ease-out forwards;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
  }

  #popupBox h2 {
    margin-top: 0;
    color: #333;
  }

  #popupBox p {
    font-size: 16px;
    color: #555;
  }

  #popupBox button, .button {
    margin-top: 15px;
    padding: 10px 25px;
    background: #00ffd5;
    color: #000;
    border: none;
    border-radius: 10px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s;
  }

  #popupBox button:hover {
    background: #00c8aa;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes zoomIn {
    from {
      transform: scale(0.6);
      opacity: 0;
    }
    to {
      transform: scale(1);
      opacity: 1;
    }
  }
      .player-bar,
      .player-barr {
      display: flex;
      justify-content: center;
      gap: 1rem;
      padding: 1rem;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      backdrop-filter: blur(5px);
      max-width: 90%;
      flex-wrap: wrap;
     
    }

    .player,
    .playerr{
      padding: 0.75rem 1rem;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.2);
      transition: all 0.3s ease;
      min-width: 90px;
      text-align: center;
    }
.playerr {
  color: white;
  min-width: 20px;
}
    .current {
      border: 2px solid #1de9b6;
      box-shadow: 0 0 12px #1de9b6;
      background-color: rgba(29, 233, 182, 0.1);
      color: #1de9b6;
    }

    .turn-button {
      margin-top: 2rem;
      padding: 0.75rem 1.5rem;
      background-color: #1de9b6;
      color: #0f172a;
      border: none;
      border-radius: 999px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .turn-button:hover {
      background-color: #16c9a1;
    }

    .turn-message {
      margin-top: 2rem;
      font-size: 1.5rem;
      font-weight: bold;
      background: linear-gradient(90deg, #1de9b6, #ffffff, #1de9b6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shine 3s linear infinite;
    }

    @keyframes shine {
      0% {
        background-position: -200% center;
      }
      100% {
        background-position: 200% center;
      }
    }

    @media (max-width: 500px) {
      .player {
        font-size: 0.9rem;
        padding: 0.5rem 0.75rem;
      }
    }
  </style>
</head>
<body>
      <div class="player-barr">
      <div class="playerr" id="playersc">0</div>
      <div class="playerr" id="cpusc">0</div>
    </div>
    
    <div class="player-bar" id="playerBar">
    <div class="player current" id="plyname">Samuel</div>
    <div class="player">ZetaCore</div>
  </div>
  
  <div id="chargeBar"><div id="chargeFill"></div></div>
  <button id="btn">Hold to Charge</button>
  <div id="message"></div>
  <div id="gameArea">
    <div id="bottle"></div>
    
    <div id="floor"><img src="../assets/table.png" alt="" height="100%" width="100%"></div>
    
  </div>
 <button onclick="Quit()" style="position: absolute; top: 0px; left: 70%;" class="button">Quit Game</button>
<div id="popupOverlay">
  <div id="popupBox">
    <h2>Game Paused</h2>
    <p>Do you want to continue?</p>
    <button onclick="closePopup()" id="popcobtn">Continue</button>
  </div>
</div>
  <script>
  checkStart();
  var loaded = false;
 function checkStart() {
    showPopup("•Don't flip too high<br> •The First player to have 15 points wins the game", "👌 Tip");
  }
    const bottle = document.getElementById('bottle');
    const chargeFill = document.getElementById('chargeFill');
    const btn = document.getElementById('btn');
    const message = document.getElementById('message');
var playerScore = document.getElementById("playersc");
var botScore = document.getElementById("cpusc");
var nxtturn = false;
let score = 0;
let cpuscore = 0;
    const bottleHeight = 120;
    const floorHeight = 40;

    let floorY = window.innerHeight/2 - bottleHeight - floorHeight;
    let positionY = floorY;
    let velocityY = 0;
    let gravity = 0.6;
    let rotation = 0;
    let rotationVelocity = 0;
    let bounceCount = 0;
    let charging = false;
    let charge = 0;
    let chargeInterval;
    let isAnimating = false;

    bottle.style.top = `${floorY}px`;

    function startCharging() {
      if (isAnimating) return;
      charging = true;
      charge = 0;
      chargeFill.style.width = '0%';
      chargeInterval = setInterval(() => {
        charge = Math.min(charge + 0.2, 20);
        chargeFill.style.width = `${(charge / 20) * 100}%`;
      }, 30);
    }
let wintime = true;
    function stopCharging() {
      if (!charging || isAnimating) return;
      charging = false;
      clearInterval(chargeInterval);
      chargeFill.style.width = '0%';
      if (allowplay&&charge > 2.0&&  charge < 3.0&& wintime) {
        charge = 2.6;
        wintime = false;
      }
      if (allowplay && charge > 5.0 && charge < 6.0 && wintime) {
  charge = 5.6;
  wintime = false;
}
      launchBottle();
    }

    function launchBottle() {
      isAnimating = true;
      velocityY = -charge * 2.5;
      rotationVelocity = charge * 3;
      bounceCount = 0;
      message.textContent = '';
      requestAnimationFrame(update);
    }

    function update() {
      velocityY += gravity;
      positionY += velocityY;
      rotation += rotationVelocity;

      if (positionY >= floorY) {
        positionY = floorY;

        if (Math.abs(velocityY) > 1) {
          velocityY = -velocityY * 0.45;
          rotationVelocity *= 0.9;
          bounceCount++;
        } else {
          velocityY = 0;
          rotationVelocity *= 0.95;
          bounceCount++;
        }

        if (Math.abs(velocityY) < 0.3 && Math.abs(rotationVelocity) < 0.1 && bounceCount > 1) {
          rotation = rotation % 360;
          settleBottle(rotation);
          return;
        }
      }

      updateVisuals();
      requestAnimationFrame(update);
    }

    function updateVisuals() {
      bottle.style.top = `${positionY}px`;
      bottle.style.transform = `translateX(-50%) rotate(${rotation}deg)`;
    }

    function settleBottle(angle) {
      isAnimating = false;

      if (angle >= 330 || angle <= 30) {
        // Upright
        smoothRotateTo(0);
 if (allowplay) {
   score += 1;
 }
 if (!allowplay) {
   cpuscore += 1;
 }

 nxtturn = false;
        message.textContent = "🎯 Perfect Landing!";
   if (allowplay) {
    /*allowplay = false;
     nextTurn();
     allowplay = true;*/
   }
   //nextTurn();
        showPopup((perfectMessages[Math.floor(Math.random() * perfectMessages.length)]),"🎯 Perfect!");
        
         if (score >= 15|| cpuscore >= 15) {
   winGame();
 }
      } else if (angle > 30 && angle < 150) {
        
        // Fall right
        nxtturn = true;
        bottle.style.marginTop = "15px";
        smoothRotateTo(90);
        message.textContent = "💥 It Fell!";
        if (allowplay) {
          wintime = true;
        }
        showPopup((failMessages[Math.floor(Math.random() * failMessages.length)]),"💥 Oops!")
      } else if (angle > 210 && angle < 330) {
        // Fall left
        nxtturn = true;
        smoothRotateTo(270);
        bottle.style.marginTop = "15px";
        message.textContent = "💥 It Fell!";
        if (allowplay) {
  wintime = true;
}
        showPopup((failMessages[Math.floor(Math.random() * failMessages.length)]),"💥 Oops!")
      } else {
        // Backward
        nxtturn = true;
        smoothRotateTo(180);
        message.textContent = "💥 It Fell!";
        showPopup((failMessages[Math.floor(Math.random() * failMessages.length)]),"💥 Oops!")
      }
      
    }

    function smoothRotateTo(targetAngle) {
      const step = () => {
        const diff = targetAngle - rotation;
        if (Math.abs(diff) < 1) {
          rotation = targetAngle;
          updateVisuals();
          return;
        }
        rotation += diff * 0.2;
        updateVisuals();
        requestAnimationFrame(step);
      };
      step();
    }
var allowplay = true;
    // Event listeners
    btn.addEventListener('mousedown',()=> {if (allowplay) {
      startCharging();
    }});
    btn.addEventListener('mouseup', stopCharging);
    btn.addEventListener('mouseleave', () => charging && stopCharging());

    btn.addEventListener('touchstart', (e) => {
     setTimeout(() => {
       btn.innerText = "Release to Flip";
     }, 50);
      e.preventDefault();
      if (allowplay) {
      startCharging();
      }
    });

    btn.addEventListener('touchend', (e) => {
      setTimeout(() => {
  btn.innerText = "Hold to Charge";
}, 50);
      e.preventDefault();
      if (allowplay) {
      stopCharging();
      }
    });

    // Resize handling
    document.getElementById("floor").style.top = (floorY - 15) + "px";
    document.getElementById("floor").style.left = ((innerWidth/2)-160)+"px";
    window.addEventListener('resize', () => {
      floorY = window.innerHeight/2 - bottleHeight - floorHeight;
      
      if (!isAnimating) {
        positionY = floorY;
        bottle.style.top = `${positionY}px`;
      }
    });
    
    /*setTimeout(() => {
      //startCharging();
      charge = 2.6;
      charging = true
    }, 1000);
    setTimeout(() => {
    
  stopCharging();
}, 2400);*/

//1400 2.6 2.7 2.8 3.85 6.9
const failMessages = [
  "💥 Oops... Try again!",
  "😅 Not quite!",
  "👎 It flopped!",
  "😬 So close!",
  "🙈 Whoopsie!",
  "🫠 Gravity wins!",
  "🤦‍♂️ That didn’t work!",
  "🫢 Bottle down!",
];

const perfectMessages = [
  "🎯 Perfect Landing!",
  "🔥 Bottle Boss!",
  "✅ Clean Landing!",
  "🏆 You’re a flippin’ legend!",
  "🙌 Smooth move!",
  "🎉 That was awesome!",
  "💫 Gravity? Never heard of it!",
  "✨ That's precision!",
];


  function showPopup(message, title = "message") {
    const overlay = document.getElementById("popupOverlay");
    const box = document.getElementById("popupBox");
    document.querySelector("#popupBox h2").textContent = title;
    document.querySelector("#popupBox p").innerHTML = message;

    overlay.style.display = "flex";

    // Reset animation
    box.style.animation = "none";
    void box.offsetWidth; // Force reflow
    box.style.animation = "zoomIn 0.4s ease-out forwards";
    if (loaded) {
    playerScore.innerText = score;
    botScore.innerText = cpuscore;
    }
  }

  function closePopup() {
    const overlay = document.getElementById("popupOverlay");
    if (gameover) {
      parent.postMessage("gameover", "*");
    }
    if (!userwin) {
    overlay.style.display = "none";
  }
    if (loaded&& nxtturn&& !userwin) {
      
    bottle.style.transform = `translateX(-50%) rotate(${0}deg)`;
    bottle.style.marginTop = "0px";
    message.innerText = "";
    charge = 0;
    rotation = 0;
    velocityY = 0;
    nextTurn();
    if (current) {
      btn.style.opacity = "0";
      allowplay = false;
    }
    else {
      btn.style.opacity = "1";
      allowplay = true;
    }
    }
    else if (!userwin) {
      loaded = true;
      if (!nxtturn&& !allowplay) {
      //  alert("un")
      message.innerText = "";
        cpuPlay();
      }
    }
  }
  
const players = document.querySelectorAll('.player');
var name;
const userIndex = 0; // Samuel (Player 1) is the user
let current = 0;

function updateTurn() {
  players.forEach((p, i) => {
    p.classList.toggle('current', i === current);
  });
  
   name = players[current].textContent;
  const message2 = current === userIndex ? "Your Turn" :` ${name}'s Turn`;
  message.innerText = message2;
  message.style.color = "greenyellow";
  if (current == 1) {
    cpuPlay();
  }
  setTimeout(() => {
    message.innerText = "";
    message.style.color = "black";
  }, 1000);
  
}

function nextTurn() {
  current = (current + 1) % players.length;
  updateTurn();
}

updateTurn();
  // 🚀 Example usage
  // showPopup("🎯 You nailed it!", "Perfect!");
  //var cpuMoves = [2.6, 4.0, 5.6, 6.9];
  var cpuMoves = [2.6, 5.6, 4.0, 3.0];
  let rt = 0;
function cpuPlay() {
  let randomMove = Math.floor(Math.random() * cpuMoves.length);
  setTimeout(() => {
    let currentMove = cpuMoves[randomMove];
   let tt = setInterval(() => {
      rt++
      if (charge >= currentMove) {
        clearInterval(tt)
        stopCharging();
      }
      
    }, 1);
    startCharging();
  }, 400);
}
var username = JSON.parse(localStorage.getItem("fancystar_fliproyale")).gamingName;
document.getElementById("plyname").innerText = username;
var currentHighscores = JSON.parse(localStorage.getItem("fancystar_fliproyale")).highScores;
var newHighscore = [username, "ZetaCore"];
var soundOption = JSON.parse(localStorage.getItem("fancystar_fliproyale")).music;
let userwin = false;
let gameover = false;
function winGame() {
  userwin = true;
  btn.style.opacity = "0";
allowplay = false;
if (score >= 15 ) {
  document.getElementById("popcobtn").style.opacity = 0;
  showPopup(`${username} VS ZetaCore <br> ${score} : ${cpuscore}<br> 🎉 ${username} wins the game`, "🏆 Winner");
  setTimeout(() => {
    document.getElementById("popcobtn").style.opacity = 1;
    document.getElementById("popcobtn").innerText = "Continue (Game Over)";
    gameover = true;
  }, 2000);
}
else if (cpuscore >= 15) {
  document.getElementById("popcobtn").style.opacity = 0;
  showPopup(`${username} VS ZetaCore <br> ${score} : ${cpuscore}<br> ZetaCore wins the game`, "😔 You Lose");
  setTimeout(() => {
    document.getElementById("popcobtn").style.opacity = 1;
    document.getElementById("popcobtn").innerText = "Continue (Game Over)";
    gameover = true;
  }, 2000);
}
newHighscore[2] = score;
newHighscore[3] = cpuscore;
currentHighscores.push(newHighscore);
//console.log(currentHighscores);
var newStorage = {
  gamingName: username,
  highScores: currentHighscores,
  music: soundOption
}
localStorage.setItem("fancystar_fliproyale", JSON.stringify(newStorage));
}

function Quit() {
  setTimeout(() => {
    parent.postMessage("gameover", "*");
  }, 200);
}
  </script>
</body>
</html>